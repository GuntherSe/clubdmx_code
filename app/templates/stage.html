{% extends 'base.html' %}

{% import "csvtable-macros.html" as tbl with context %}
{% import "base-macros.html" as base with context %}
{% import "index-macros.html" as idx %}

{% macro position (left, top, width, height) %}
style="left:{{ left }}; top:{{ top }}; width:{{ width }}; height:{{ height }};"
{% endmacro %}


{% block header %}
  <h2> {% block title %} Bühne {% endblock %} </h2>
{% endblock %}

{% block subtitle %}
  {{ base.subtitle_with_button (shortname, 
      svgid = "#svg-gear",
      endpoint = url_for ('data.dataedit_stage', 
                 history=url_for('stage.show')) )
  }}
{% endblock %}

{% block workspace %}
<div class="row">
  <div class="col col-9"></div>
  <div class="col col-1"></div>
  <div class="col col-1">
    {{ base.svg_button_js ("#svg-arrow-up", "scroll-up", size="1.5em") }}
   </div>
   <div class="col col-1"></div>
</div>

<div class="row">
  <div class="col col-9"></div>
  <div class="col col-1">
    {{ base.svg_button_js ("#svg-arrow-left", "scroll-left", size="1.5em") }}
  </div>
  <div class="col col-1"></div>
  <div class="col col-1">
    {{ base.svg_button_js ("#svg-arrow-right", "scroll-right", size="1.5em") }}
  </div>
</div>

<div class="row">
  <div class="col col-9"></div>
  <div class="col col-1"></div>
  <div class="col col-1">
    {{ base.svg_button_js ("#svg-arrow-down", "scroll-down", size="1.5em") }}
  </div>
  <div class="col col-1"></div>
</div>
{% endblock %}

{% block css %}
<style>
</style>
{% endblock %}

{% block content %}
<!-- neue Zeile: Formular -->
<div class="row">
  <div class="col" id="links"></div>
  <div class="col" id="rechts"></div>
</div>  

<!-- Button für modaldialogToPython -->
<div id="showModal"></div>

<div id="stagewrapper" class="stage-wrapper">
  {{ tbl.stage_nav () }}

  <!-- <div id="canvas" class="stage-canvas"> -->

    <div id="csvtable" class=" bg-light stage" 
        file="{{ file }}" pluspath="{{ pluspath }}" changes="{{ changes }}">
<!-- ui-widget-content -->
      {% for item in items %}
      <div class="stage-element {{ item.Type.lower() }}" 
        row_num="{{ loop.index }}"
        {{ position (left=item.Left,   top=item.Top, 
                    width=item.Width, height=item.Height ) }} >
        {% if item.Type == "Head" %}
          <div class="intensity-container">
            <div class="intensity-indicator head-{{ item.Name }}"></div>
          </div>
          <div class="color-indicator"></div>
        {% endif %}
        <div class="itemName edit_div text-wrap">{{ item.Name }}</div>
        <div class="itemText edit_div text-wrap">{{ item.Text }}</div>
        <div class="itemComment edit_div text-wrap">{{ item.Comment }}</div>
      </div>
      {% endfor %}
    </div> 

  <!-- </div> canvas -->
</div>
{% endblock %}

{% block javascript %}
  <script src="/static/js/stage.js"></script>
  <script>
    function initMouseMode () {
      // wird in der jeweiligen html-Seite neu definiert
      initStageMouse ();
    };
   
    $(document).ready ( function () {  
      initStageMouse ();
      // selectableStageElements ();
      periodic_attribstatus ();
      csvSavediscardButtons ();
      $(".scroll-down").on ("click", function (){
        var stagetop = $("#csvtable").scrollTop ();
        var height = $("#csvtable").height ();
        $("#csvtable").scrollTop (stagetop + height/2);
      });
      $(".scroll-up").on ("click", function (){
        var stagetop = $("#csvtable").scrollTop ();
        var height = $("#csvtable").height ();
        if (stagetop >= height/2) {
          $("#csvtable").scrollTop (stagetop - height/2);
        } else {
          $("#csvtable").scrollTop (0);
        };
      });
      $(".scroll-left").on ("click", function (){
        var stageleft = $("#csvtable").scrollLeft ();
        var width = $("#csvtable").width ();
        if (stageleft >= width/2) {
          $("#csvtable").scrollLeft (stageleft - width/2);
        } else {
          $("#csvtable").scrollLeft (0);
        };
      });
      $(".scroll-right").on ("click", function (){
        var stageleft = $("#csvtable").scrollLeft ();
        var width = $("#csvtable").width ();
        $("#csvtable").scrollLeft (stageleft + width/2);
      });
      
    });  

  </script>
{% endblock %}

