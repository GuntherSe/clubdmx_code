<!-- Cuelist - Faderpage -->
{% extends 'base.html' %}

{% import "csvtable-macros.html" as tbl with context %}
{% import "base-macros.html" as base with context %}

{% macro cl_fadertable (header, d, filebuttons="false") %}
<div class="container">
  {% set items = d["items"] %}
  {% if items|length > 0 %}
  <div class="shadow p-3 mb-5 rounded"> {# shadow #}
    <h5 class="alert alert-info">{{ header }}</h5>
    <table table_id="{{ d['loc'] }}" class="table csvfile " 
            file="{{ d['shortname'] }}" 
            pluspath="{{ d['pluspath'] }}" 
            option="{{ d['option'] }}">
      <tbody>
        {% for item in items %}
          <tr class="row pt-2"></tr>
          {{ base.cueslider (item.Text, item.Filename, 
                loop.index, 1+d["textcolumn"], item.Index, filebuttons) }}
          <tr class="row">
            {{ cl_status  (item.Index) }}
            {{ cl_buttons (item.Index) }}
          </tr>
          <tr class="row border-bottom pb-2"></tr>
        {% endfor %}
      </tbody>  
    </table>
  
  </div>
  {% endif %}
</div>
{% endmacro %}

{# cuelist Buttons: Go, Pause, next+1, next-1 #}
{% macro cl_buttons (index) %}
  <td class="col-2 border-0">
    <button type="button" id="cuelistpause-{{ index }}" index="{{ index }}" 
      class="btn btn-secondary pausebutton w-50 mx-auto">||</button>
  </td>
  <td class="col-2 border-0">
    <button type="button" id="cuelistgo-{{ index }}" index="{{ index }}" 
      class="btn btn-primary gobutton w-50 mx-auto">Go</button>
  </td>
{% endmacro %}

{# cuelist Status: #}
{% macro cl_status (index) %}
<td class="col-1  border border-info rounded-pill"> {# id #}
  <h3 id="currentid-{{ index }}" index="{{ index }}" 
    class="text-primary text-center font-weight-bold align-text-bottom"></h3>
</td>
<td class="col-1 border border-success rounded-pill"> {# next #}
  <h3 id="nextid-{{ index }}" index="{{ index }}" 
    class="text-primary text-center align-text-bottom"></h3>
</td>
<td class="col-4 "> {# fading Info #}
  <div id="fadein-{{ index }}" class="progress">
    <div id="fadein-indicator-{{ index }}" class="progress-bar bg-success" 
      role="progressbar" aria-valuenow="0" style="transition:400ms;"
      aria-valuemin="0" aria-valuemax="100"></div>
  </div>
  <div id="fadeout-{{ index }}" class="progress">
    <div id="fadeout-indicator-{{ index }}" class="progress-bar bg-info" 
      role="progressbar" aria-valuenow="0" style="transition:400ms;"
      aria-valuemin="0" aria-valuemax="100"></div>
  </div>
</td>
{% endmacro %}

{% block header %} 
  <h2> {% block title %}Cuelist{% endblock %} </h2>
{% endblock %}

{#% set subtext = data.exefaders.shortname ~ ", " ~ data.cuefaders.shortname %#}
{#% block subtitle %}
  {{ base.subtitle_with_button ("",
    svgid = "#svg-gear",
    endpoint = url_for ('basic.fadertable') )
  }}
{% endblock %#}

{% block css %}
{% endblock %}

{% block content %}
<!-- Button für modaldialogToPython -->
<div id="showCueModal"></div>

<div>
  <!-- Cuelist -->
  {{ cl_fadertable ("Page 1", data) }}
</div>
{% endblock %}


{% block javascript %}
<script src="/static/js/cuelist.js"></script>

<script>

  $("document").ready (function () {
    
    var sliderwidth;
    // Sliderbreite mit Fenserbreite verändern:
    $(window).on('resize', function(){
      sliderwidth = $(".col-8").width();
      $(".slider").width (sliderwidth);
    });

    sliderwidth = $(".col-8").width();
    // editableCsvFields ();

    // slider erzeugen:
    // var sliderlevels;
    $.get ("/cuelist/status", function (data) {
      // console.log ("data: " + data);
      var jdata = $.parseJSON(data);
      var sliderlevels = jdata["levels"];

      var i;
      for (i = 0; i < sliderlevels.length; i++){
        makeSlider(i, sliderlevels, "cuelistlevel");
      };
      $(".slider").width (sliderwidth);
    });
    periodic_cueliststatus ();

    // Buttons aktivieren:
    activateCuelistbuttons ();

  });     // ende document ready
</script>
{% endblock %}

